<!DOCTYPE html>
<!-- Declaration of language and apis to be used in html -->
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ClosedSea</title>
        <link rel="stylesheet" href="css/create-nft-piece.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    </head>
    <body>
        <!-- Header declaration with css file --->
        <header class="header">
            <!--NavBar declaration and functions-->
            <nav class="nav">
                <!-- Navbar logo and avatar logo --->
                <img src="./Resources/closedsea%20favicon.png" class="favicon">
                <!-- Navbar text logo --->
                <a href="javascript: history.go(-1)" class="logo nav-link">ClosedSea</a>
                <!-- Navbar made with an ordered list and within that list an unordered list --->
                <ul class="nav-menu">
                    <li class="nav-menu-item">
                        <a href="explore.html" class="nav-menu-link nav-link">Explore</a>
                    </li>
                    <li class="nav-menu-item ">
                        <a href="wallet.html" class="nav-menu-link nav-link">Wallet</a>
                    </li>
                </ul>
            </nav>
        </header>
        <!-- Nft main page and main div with information -->
        <form id="createNftForm">
            <div class="form">
                <!-- Create a new nft title -->
                <h1>Crear nuevo NFT</h1>
                <!-- Nft title information -->
                <div class="grupo">
                    <input type="text" id="id" required><span class="barra"></span>
                    <label>Id</label>
                </div>

                <div class="grupo">
                    <input type="text" id="name" required><span class="barra"></span>
                    <label>Titulo del NFT</label>
                </div>

                <div class="grupo">
                    <input type="text" id="price" required><span class="barra"></span>
                    <label>Precio</label>
                </div>
                <!-- Image input div -->

              <!--<div class="grupo">
                    <button type="button" id="imagebutton">Subir</button>
                </div>-->

                <div class="grupo">
                    <input type="file" id="imagePath" onchange="getUrl();">
                </div>

                <!-- Final price div with label -->

              <div class="lblcheckbox">
                    <label class="lblcheckbox">¿Esta a la venta?</label>
                </div>

               <!--<div>
                    <input type="checkbox" id="checkboxForm">
                </div>
-->
                <div class="grupo">
                   <center><select id="forSale" required>
                        <option value="Sí" name="Sí">Sí</option>
                        <option value="No" name="No">No</option>
                    </select></center>
                </div>

                <!-- Create button  -->
                    <button type="submit" id="createButton">Crear</button>
                <!-- Discard button  -->
                <a href="javascript: history.go(-1)">
                    <button type="button">Descartar</button>
                </a>
            </div>
        </form>

       <!--<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
        <script src="Scripts/imageServiceWidget.js"></script>-->

        <script>

            const createNftForm = document.querySelector("form");

            createNftForm.onsubmit = async (e) => {

                e.preventDefault()
                let data = {
                    "id": document.getElementById("id").value,
                    "name": document.getElementById("name").value,
                    "forSale": document.getElementById("forSale").value,
                    "imagePath": document.getElementById("imagePath").files[0].name,
                    "price": document.getElementById("price").value,
                };

                let response = await fetch("./api/collections/" + data.id + "/arts", {
                    method: "POST",
                    headers: {
                        "Content-type": "application/json"
                    },
                    body: JSON.stringify(data),
                });

                let message = await response.json();
                alert(message);

                if (data.forSale === "No") {
                    sessionStorage.setItem(false, data.forSale);
                } else {
                    sessionStorage.setItem(true, data.forSale);
                }

                sessionStorage.setItem("name", data.name);
                sessionStorage.setItem("imagePath", data.imagePath);
                sessionStorage.setItem("price", data.price);

                window.location.href = "create-nft-piece.html";
            }
        </script>

    </body>
</html>